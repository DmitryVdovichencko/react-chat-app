"use strict";

var _ws = _interopRequireDefault(require("ws"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const wss = new _ws.default.Server({
  port: 8989
});
const users = [];

const broadcast = (data, ws) => {
  wss.clients.forEach(client => {
    if (client.readyState === _ws.default.OPEN && client !== ws) {
      client.send(JSON.stringify(data));
    }
  });
};

wss.on('connection', ws => {
  let index;
  ws.on('message', message => {
    const data = JSON.parse(message);

    switch (data.type) {
      case 'ADD_USER':
        {
          index = users.length;
          users.push({
            name: data.name,
            id: index + 1
          });
          ws.send(JSON.stringify({
            type: 'USERS_LIST',
            users
          }));
          broadcast({
            type: 'USERS_LIST',
            users
          }, ws);
          break;
        }

      case 'ADD_MESSAGE':
        broadcast({
          type: 'ADD_MESSAGE',
          message: data.message,
          author: data.author
        }, ws);
        break;

      default:
        break;
    }
  });
  ws.on('close', () => {
    users.splice(index, 1);
    broadcast({
      type: 'USERS_LIST',
      users
    }, ws);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJ3c3MiLCJXZWJTb2NrZXQiLCJTZXJ2ZXIiLCJwb3J0IiwidXNlcnMiLCJicm9hZGNhc3QiLCJkYXRhIiwid3MiLCJjbGllbnRzIiwiZm9yRWFjaCIsImNsaWVudCIsInJlYWR5U3RhdGUiLCJPUEVOIiwic2VuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJvbiIsImluZGV4IiwibWVzc2FnZSIsInBhcnNlIiwidHlwZSIsImxlbmd0aCIsInB1c2giLCJuYW1lIiwiaWQiLCJhdXRob3IiLCJzcGxpY2UiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7QUFFQSxNQUFNQSxHQUFHLEdBQUcsSUFBSUMsWUFBVUMsTUFBZCxDQUFxQjtBQUFFQyxFQUFBQSxJQUFJLEVBQUU7QUFBUixDQUFyQixDQUFaO0FBRUEsTUFBTUMsS0FBSyxHQUFHLEVBQWQ7O0FBRUEsTUFBTUMsU0FBUyxHQUFHLENBQUNDLElBQUQsRUFBTUMsRUFBTixLQUFhO0FBQzdCUCxFQUFBQSxHQUFHLENBQUNRLE9BQUosQ0FBWUMsT0FBWixDQUFxQkMsTUFBRCxJQUFZO0FBQzlCLFFBQUlBLE1BQU0sQ0FBQ0MsVUFBUCxLQUFzQlYsWUFBVVcsSUFBaEMsSUFBd0NGLE1BQU0sS0FBSUgsRUFBdEQsRUFBeUQ7QUFDdkRHLE1BQUFBLE1BQU0sQ0FBQ0csSUFBUCxDQUFZQyxJQUFJLENBQUNDLFNBQUwsQ0FBZVQsSUFBZixDQUFaO0FBQ0Q7QUFDRixHQUpEO0FBS0QsQ0FORDs7QUFRQU4sR0FBRyxDQUFDZ0IsRUFBSixDQUFPLFlBQVAsRUFBc0JULEVBQUQsSUFBTTtBQUN6QixNQUFJVSxLQUFKO0FBQ0FWLEVBQUFBLEVBQUUsQ0FBQ1MsRUFBSCxDQUFNLFNBQU4sRUFBa0JFLE9BQUQsSUFBWTtBQUMzQixVQUFNWixJQUFJLEdBQUdRLElBQUksQ0FBQ0ssS0FBTCxDQUFXRCxPQUFYLENBQWI7O0FBQ0EsWUFBUVosSUFBSSxDQUFDYyxJQUFiO0FBQ0UsV0FBSyxVQUFMO0FBQWlCO0FBQ2ZILFVBQUFBLEtBQUssR0FBR2IsS0FBSyxDQUFDaUIsTUFBZDtBQUNBakIsVUFBQUEsS0FBSyxDQUFDa0IsSUFBTixDQUFXO0FBQUNDLFlBQUFBLElBQUksRUFBRWpCLElBQUksQ0FBQ2lCLElBQVo7QUFBa0JDLFlBQUFBLEVBQUUsRUFBRVAsS0FBSyxHQUFDO0FBQTVCLFdBQVg7QUFDQVYsVUFBQUEsRUFBRSxDQUFDTSxJQUFILENBQVFDLElBQUksQ0FBQ0MsU0FBTCxDQUFlO0FBQ3JCSyxZQUFBQSxJQUFJLEVBQUMsWUFEZ0I7QUFFckJoQixZQUFBQTtBQUZxQixXQUFmLENBQVI7QUFJQUMsVUFBQUEsU0FBUyxDQUFDO0FBQ1JlLFlBQUFBLElBQUksRUFBQyxZQURHO0FBRVJoQixZQUFBQTtBQUZRLFdBQUQsRUFHTkcsRUFITSxDQUFUO0FBSUE7QUFDRDs7QUFDRCxXQUFLLGFBQUw7QUFDRUYsUUFBQUEsU0FBUyxDQUFDO0FBQ1JlLFVBQUFBLElBQUksRUFBQyxhQURHO0FBRVJGLFVBQUFBLE9BQU8sRUFBQ1osSUFBSSxDQUFDWSxPQUZMO0FBR1JPLFVBQUFBLE1BQU0sRUFBRW5CLElBQUksQ0FBQ21CO0FBSEwsU0FBRCxFQUlQbEIsRUFKTyxDQUFUO0FBS0E7O0FBQ0Y7QUFDRTtBQXRCSjtBQXdCRCxHQTFCRDtBQTJCQUEsRUFBQUEsRUFBRSxDQUFDUyxFQUFILENBQU0sT0FBTixFQUFlLE1BQUk7QUFDakJaLElBQUFBLEtBQUssQ0FBQ3NCLE1BQU4sQ0FBYVQsS0FBYixFQUFtQixDQUFuQjtBQUNBWixJQUFBQSxTQUFTLENBQUM7QUFDUmUsTUFBQUEsSUFBSSxFQUFDLFlBREc7QUFFUmhCLE1BQUFBO0FBRlEsS0FBRCxFQUdORyxFQUhNLENBQVQ7QUFJRCxHQU5EO0FBT0QsQ0FwQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgV2ViU29ja2V0IGZyb20gJ3dzJ1xuXG5jb25zdCB3c3MgPSBuZXcgV2ViU29ja2V0LlNlcnZlcih7IHBvcnQ6IDg5ODkgfSlcblxuY29uc3QgdXNlcnMgPSBbXVxuXG5jb25zdCBicm9hZGNhc3QgPSAoZGF0YSx3cykgPT4ge1xuICB3c3MuY2xpZW50cy5mb3JFYWNoKChjbGllbnQpID0+IHtcbiAgICBpZiAoY2xpZW50LnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOICYmIGNsaWVudCE9PSB3cyl7XG4gICAgICBjbGllbnQuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSlcbiAgICB9XG4gIH0pO1xufVxuXG53c3Mub24oJ2Nvbm5lY3Rpb24nLCAod3MpPT57XG4gIGxldCBpbmRleFxuICB3cy5vbignbWVzc2FnZScsIChtZXNzYWdlKT0+IHtcbiAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShtZXNzYWdlKVxuICAgIHN3aXRjaCAoZGF0YS50eXBlKSB7XG4gICAgICBjYXNlICdBRERfVVNFUic6IHtcbiAgICAgICAgaW5kZXggPSB1c2Vycy5sZW5ndGhcbiAgICAgICAgdXNlcnMucHVzaCh7bmFtZTogZGF0YS5uYW1lLCBpZDogaW5kZXgrMX0pXG4gICAgICAgIHdzLnNlbmQoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHR5cGU6J1VTRVJTX0xJU1QnLFxuICAgICAgICAgIHVzZXJzXG4gICAgICAgIH0pKVxuICAgICAgICBicm9hZGNhc3Qoe1xuICAgICAgICAgIHR5cGU6J1VTRVJTX0xJU1QnLFxuICAgICAgICAgIHVzZXJzXG4gICAgICAgIH0sIHdzKVxuICAgICAgICBicmVha1xuICAgICAgfVxuICAgICAgY2FzZSAnQUREX01FU1NBR0UnOlxuICAgICAgICBicm9hZGNhc3Qoe1xuICAgICAgICAgIHR5cGU6J0FERF9NRVNTQUdFJyxcbiAgICAgICAgICBtZXNzYWdlOmRhdGEubWVzc2FnZSxcbiAgICAgICAgICBhdXRob3I6IGRhdGEuYXV0aG9yXG4gICAgICAgIH0sd3MpXG4gICAgICAgIGJyZWFrXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVha1xuICAgIH1cbiAgfSlcbiAgd3Mub24oJ2Nsb3NlJywgKCk9PntcbiAgICB1c2Vycy5zcGxpY2UoaW5kZXgsMSlcbiAgICBicm9hZGNhc3Qoe1xuICAgICAgdHlwZTonVVNFUlNfTElTVCcsXG4gICAgICB1c2Vyc1xuICAgIH0sIHdzKVxuICB9KVxufSlcbiJdfQ==